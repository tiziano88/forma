Keep changes small, and check that the code still compiles after each change, by running `pnpm -r build`.

Add type annotations for all methods, and avoid using `any`.
